<!DOCTYPE html>
<html lang="fr" dir="ltr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Al Wassiya - Votre Testament Islamique Simplifi√©</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Poppins:wght@300;400;500;600&display=swap"
        rel="stylesheet"
    />
    <style>
        :root {
            --primary: #c9b178;
            --primary-dark: #a89262;
            --secondary: #2d4c68;
            --accent: #3a5f7e;
            --light: #f8f5ee;
            --dark: #1e1e24;
            --success: #4caf50;
            --error: #e74c3c;
            --radius: 16px;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Poppins", sans-serif;
            background: linear-gradient(135deg, #f8f5ee 0%, #e6e2d6 100%);
            color: var(--dark);
            line-height: 1.7;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header Styles */
        .header {
            text-align: center;
            padding: 40px 0;
            margin-bottom: 30px;
            position: relative;
        }

        .logo-container {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            margin-bottom: 10px;
        }

        .logo {
            font-family: "Playfair Display", serif;
            font-size: 3.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 5px;
            letter-spacing: 1px;
        }

        .logo-ar {
            font-family: "Arial", sans-serif;
            font-size: 3.2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 10px;
            letter-spacing: 0;
            line-height: 1.2;
        }

        .language-switcher {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }

        .lang-btn {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
        }

        .lang-btn:hover,
        .lang-btn.active {
            background: var(--primary);
            color: white;
        }

        .subtitle {
            font-size: 1.2rem;
            color: var(--secondary);
            margin-bottom: 25px;
            font-weight: 400;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .bismillah {
            font-size: 2.2rem;
            color: var(--primary);
            margin: 25px 0;
            font-weight: 600;
        }

        /* Progress Section */
        .progress-container {
            background: white;
            border-radius: var(--radius);
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
        }

        .progress-bar {
            height: 8px;
            background: #ede8dd;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--primary-dark));
            width: 15%;
            border-radius: 4px;
            transition: var(--transition);
        }

        .step-indicator {
            font-size: 1.1rem;
            color: var(--secondary);
            font-weight: 500;
        }

        /* Quranic Verse */
        .quranic-verse {
            background: linear-gradient(
                135deg,
                rgba(201, 177, 120, 0.1) 0%,
                rgba(168, 146, 98, 0.1) 100%
            );
            border-left: 4px solid var(--primary);
            padding: 25px;
            margin: 30px 0;
            border-radius: 0 var(--radius) var(--radius) 0;
            font-style: italic;
            color: var(--secondary);
            font-size: 1.1rem;
            line-height: 1.8;
            text-align: center;
        }

        .arabic-verse {
            font-size: 1.6rem;
            margin-bottom: 20px;
            line-height: 2;
            font-weight: 600;
            color: var(--primary-dark);
        }

        .translation-note {
            font-size: 0.9rem;
            color: var(--primary-dark);
            margin-top: 10px;
            font-style: italic;
        }

        /* Form Styles */
        .form-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
        }

        @media (min-width: 992px) {
            .form-container {
                grid-template-columns: 1fr 1fr;
            }
        }

        .form-section {
            background: white;
            border-radius: var(--radius);
            padding: 30px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .form-section:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }

        .section-title {
            font-family: "Playfair Display", serif;
            font-size: 1.6rem;
            color: var(--secondary);
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(201, 177, 120, 0.3);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .section-title i {
            color: var(--primary);
            font-size: 1.4rem;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            color: var(--secondary);
            font-weight: 500;
            font-size: 1.05rem;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 16px;
            border: 2px solid #ede8dd;
            border-radius: 10px;
            background: #fcfaf7;
            color: var(--dark);
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(201, 177, 120, 0.2);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 130px;
        }

        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: #a0a0a0;
        }

        .form-group select option {
            padding: 12px;
        }

        .required {
            color: var(--error);
        }

        /* Family Section Styles */
        .family-category {
            margin-bottom: 30px;
            padding: 20px;
            border-radius: var(--radius);
            background: #f8f5ee;
            border: 1px solid rgba(201, 177, 120, 0.2);
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            cursor: pointer;
        }

        .category-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--secondary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .person-entry {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.03);
        }

        .add-person-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
        }

        .add-person-btn:hover {
            background: var(--primary-dark);
        }

        .remove-person-btn {
            background: var(--error);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 10px;
            font-size: 0.9rem;
        }

        /* Asset Section Styles */
        .asset-category {
            margin-bottom: 30px;
            padding: 20px;
            border-radius: var(--radius);
            background: #f8f5ee;
            border: 1px solid rgba(201, 177, 120, 0.2);
        }

        .asset-entry {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.03);
        }

        /* Buttons */
        .actions {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin: 40px 0;
        }

        .btn {
            padding: 16px 32px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 20px rgba(168, 146, 98, 0.4);
        }

        .btn-secondary {
            background: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
        }

        .btn-secondary:hover {
            background: var(--primary);
            color: white;
        }

        /* Share Buttons */
        .share-section {
            text-align: center;
            margin: 30px 0;
            background: white;
            padding: 25px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }

        .share-title {
            font-size: 1.2rem;
            color: var(--secondary);
            margin-bottom: 20px;
            font-weight: 600;
        }

        .share-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .share-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 55px;
            height: 55px;
            border-radius: 50%;
            color: white;
            font-size: 1.3rem;
            transition: var(--transition);
            cursor: pointer;
        }

        .share-btn:hover {
            transform: translateY(-3px) scale(1.05);
        }

        .whatsapp {
            background: #25d366;
        }
        .facebook {
            background: #3b5998;
        }
        .twitter {
            background: #1da1f2;
        }
        .email {
            background: #d44638;
        }

        /* Footer */
        .footer-note {
            background: white;
            border-radius: var(--radius);
            padding: 30px;
            margin-top: 50px;
            box-shadow: var(--shadow);
        }

        .footer-note p {
            margin-bottom: 15px;
            color: var(--secondary);
        }

        .footer-note p:last-child {
            margin-bottom: 0;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .logo {
                font-size: 2.8rem;
            }

            .logo-ar {
                font-size: 2.5rem;
            }

            .bismillah {
                font-size: 1.8rem;
            }

            .arabic-verse {
                font-size: 1.4rem;
            }

            .form-section {
                padding: 25px 20px;
            }

            .section-title {
                font-size: 1.4rem;
            }

            .actions {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }

            .share-buttons {
                gap: 10px;
            }

            .share-btn {
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
            }

            .language-switcher {
                position: relative;
                top: 0;
                right: 0;
                justify-content: center;
                margin-bottom: 20px;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .form-section {
            animation: fadeIn 0.6s ease-out;
        }

        /* Islamic Pattern Background */
        .islamic-pattern {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: radial-gradient(
                    circle at 20% 30%,
                    rgba(201, 177, 120, 0.03) 0%,
                    transparent 40%
                ),
                radial-gradient(
                    circle at 80% 70%,
                    rgba(168, 146, 98, 0.03) 0%,
                    transparent 40%
                );
            pointer-events: none;
            z-index: -1;
        }

        /* Step Navigation */
        .step-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }

        .privacy-notice {
            background-color: #f8f5ee;
            border-left: 4px solid var(--primary);
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 var(--radius) var(--radius) 0;
            font-size: 0.9rem;
            color: var(--secondary);
        }

        .zakat-calculator {
            background-color: white;
            border-radius: var(--radius);
            padding: 20px;
            margin: 20px 0;
            box-shadow: var(--shadow);
        }

        .calculator-result {
            margin-top: 15px;
            padding: 15px;
            background-color: var(--light);
            border-radius: var(--radius);
            font-weight: 500;
            color: var(--secondary);
            display: none;
        }

        /* RTL Support */
        body[dir="rtl"] {
            text-align: right;
            font-family: "Arial", sans-serif;
        }

        body[dir="rtl"] .form-group input,
        body[dir="rtl"] .form-group textarea,
        body[dir="rtl"] .form-group select {
            text-align: right;
        }

        body[dir="rtl"] .category-header {
            flex-direction: row-reverse;
        }

        body[dir="rtl"] .quranic-verse {
            border-left: none;
            border-right: 4px solid var(--primary);
            border-radius: var(--radius) 0 0 var(--radius);
        }

        body[dir="rtl"] .privacy-notice {
            border-left: none;
            border-right: 4px solid var(--primary);
            border-radius: var(--radius) 0 0 var(--radius);
        }

        body[dir="rtl"] .section-title {
            flex-direction: row-reverse;
        }
    </style>
</head>
<body>
    <div class="islamic-pattern"></div>

    <div class="container">
        <div class="header">
            <div class="logo-container">
                <div class="logo">Al Wassiya</div>
                <div class="logo-ar">ÿßŸÑŸàÿµŸäÿ©</div>
            </div>
            <div class="language-switcher">
                <button class="lang-btn active" data-lang="fr">Fran√ßais</button>
                <button class="lang-btn" data-lang="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</button>
            </div>
            <div class="subtitle" data-i18n="subtitle">Votre Testament Islamique Simplifi√©</div>
            <div class="bismillah">ÿ®Ÿêÿ≥ŸíŸÖŸê ÿßŸÑŸÑŸéŸëŸáŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸíŸÖŸéŸÜŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸêŸäŸÖ</div>
            <p data-i18n="description">
                Cr√©ez facilement un testament islamique respectant le Coran et la Sunna
            </p>
        </div>

        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="step-indicator" id="stepIndicator" data-i18n="step1">
                √âtape 1 sur 6 : Informations personnelles et volont√©s g√©n√©rales
            </div>
        </div>

        <div class="quranic-verse">
            <div class="arabic-verse">ŸÉŸèÿ™Ÿêÿ®Ÿé ÿπŸéŸÑŸéŸäŸíŸÉŸèŸÖŸí ÿ•Ÿêÿ∞Ÿéÿß ÿ≠Ÿéÿ∂Ÿéÿ±Ÿé ÿ£Ÿéÿ≠ŸéÿØŸéŸÉŸèŸÖŸè ÿßŸÑŸíŸÖŸéŸàŸíÿ™Ÿè ÿ•ŸêŸÜ ÿ™Ÿéÿ±ŸéŸÉŸé ÿÆŸéŸäŸíÿ±Ÿãÿß ÿßŸÑŸíŸàŸéÿµŸêŸäŸéŸëÿ©Ÿè ŸÑŸêŸÑŸíŸàŸéÿßŸÑŸêÿØŸéŸäŸíŸÜŸê ŸàŸéÿßŸÑŸíÿ£ŸéŸÇŸíÿ±Ÿéÿ®ŸêŸäŸÜŸé ÿ®ŸêÿßŸÑŸíŸÖŸéÿπŸíÿ±ŸèŸàŸÅŸê €ñ ÿ≠ŸéŸÇŸãŸëÿß ÿπŸéŸÑŸéŸâ ÿßŸÑŸíŸÖŸèÿ™ŸéŸëŸÇŸêŸäŸÜŸé</div>
            <div data-i18n="verseTranslation">
                "Il vous est prescrit, quand la mort se pr√©sente √† l'un de vous, s'il laisse des
                biens, de faire un testament en faveur de ses p√®re et m√®re et de ses proches, selon
                les convenances. C'est un devoir pour les pieux." - Sourate Al-Baqara, verset 180
            </div>
            <div class="translation-note" data-i18n="translationNote">(c'est une traduction rapproch√©e)</div>
        </div>

        <!-- √âtape 1: Informations personnelles (inchang√©e) -->
        <form id="testamentForm">
            <div id="step1" class="form-step">
                <div class="form-container">
                    <div class="form-section">
                        <h2 class="section-title">
                            <i class="fas fa-user"></i> <span data-i18n="identityTitle">Identit√© du d√©funt</span>
                        </h2>

                        <div class="form-group">
                            <label for="sexe" data-i18n="genderLabel">Sexe <span class="required">*</span></label>
                            <select id="sexe" name="sexe" required onchange="toggleConjointField()">
                                <option value="" data-i18n="selectOption">S√©lectionner</option>
                                <option value="homme" data-i18n="manOption">Homme</option>
                                <option value="femme" data-i18n="womanOption">Femme</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="prenom" data-i18n="firstNameLabel">Pr√©nom <span class="required">*</span></label>
                            <input
                                type="text"
                                id="prenom"
                                name="prenom"
                                required
                                data-i18n-placeholder="firstNamePlaceholder"
                                placeholder="Votre pr√©nom"
                            />
                        </div>

                        <div class="form-group">
                            <label for="nom" data-i18n="lastNameLabel">Nom de famille <span class="required">*</span></label>
                            <input
                                type="text"
                                id="nom"
                                name="nom"
                                required
                                data-i18n-placeholder="lastNamePlaceholder"
                                placeholder="Votre nom de famille"
                            />
                        </div>

                        <div class="form-group">
                            <label for="dateNaissance" data-i18n="birthDateLabel">Date de naissance <span class="required">*</span></label>
                            <input type="date" id="dateNaissance" name="dateNaissance" required />
                        </div>

                        <div class="form-group">
                            <label for="lieuNaissance" data-i18n="birthPlaceLabel">Lieu de naissance</label>
                            <input
                                type="text"
                                id="lieuNaissance"
                                name="lieuNaissance"
                                data-i18n-placeholder="birthPlacePlaceholder"
                                placeholder="Ville et pays de naissance"
                            />
                        </div>

                        <div class="form-group">
                            <label for="adresse" data-i18n="addressLabel">Adresse actuelle <span class="required">*</span></label>
                            <textarea
                                id="adresse"
                                name="adresse"
                                required
                                data-i18n-placeholder="addressPlaceholder"
                                placeholder="Votre adresse compl√®te"
                            ></textarea>
                        </div>

                        <div class="form-group">
                            <label for="nationalite" data-i18n="nationalityLabel">Nationalit√©</label>
                            <input
                                type="text"
                                id="nationalite"
                                name="nationalite"
                                data-i18n-placeholder="nationalityPlaceholder"
                                placeholder="Votre nationalit√©"
                            />
                        </div>

                        <div class="form-group">
                            <label for="situationFamiliale" data-i18n="maritalStatusLabel">Situation familiale</label>
                            <select id="situationFamiliale" name="situationFamiliale" onchange="toggleConjointField()">
                                <option value="" data-i18n="selectOption">S√©lectionner</option>
                                <option value="celibataire" data-i18n="singleOption">C√©libataire</option>
                                <option value="marie" data-i18n="marriedOption">Mari√©(e)</option>
                                <option value="divorce" data-i18n="divorcedOption">Divorc√©(e)</option>
                                <option value="veuf" data-i18n="widowedOption">Veuf/Veuve</option>
                            </select>
                        </div>

                        <div class="form-group" id="conjointGroup" style="display: none">
                            <label for="conjoint" id="conjointLabel" data-i18n="spouseLabel">Identit√© de l'√©poux/√©pouse</label>
                            <input
                                type="text"
                                id="conjoint"
                                name="conjoint"
                                data-i18n-placeholder="spousePlaceholder"
                                placeholder="Nom et pr√©nom du conjoint"
                            />
                        </div>
                    </div>

                    <div class="form-section">
                        <h2 class="section-title">
                            <i class="fas fa-scroll"></i> <span data-i18n="willsTitle">Volont√©s g√©n√©rales</span>
                        </h2>

                        <div class="form-group">
                            <label for="volontesObseques" data-i18n="funeralWishesLabel">Volont√©s concernant les obs√®ques</label>
                            <textarea
                                id="volontesObseques"
                                name="volontesObseques"
                                data-i18n-placeholder="funeralWishesPlaceholder"
                                placeholder="Indiquez vos souhaits concernant l'inhumation, la mosqu√©e pour la pri√®re, le lieu de s√©pulture, etc."
                            ></textarea>
                        </div>

                        <div class="form-group">
                            <label for="recommandationsFamille" data-i18n="familyRecommendationsLabel">Recommandations √† la famille</label>
                            <textarea
                                id="recommandationsFamille"
                                name="recommandationsFamille"
                                data-i18n-placeholder="familyRecommendationsPlaceholder"
                                placeholder="Messages, conseils ou recommandations pour votre famille"
                            ></textarea>
                        </div>

                        <div class="form-group">
                            <label for="executeurTestament" data-i18n="executorLabel">Ex√©cuteur testamentaire sugg√©r√©</label>
                            <input
                                type="text"
                                id="executeurTestament"
                                name="executeurTestament"
                                data-i18n-placeholder="executorPlaceholder"
                                placeholder="Nom de la personne de confiance"
                            />
                        </div>

                        <div class="form-group">
                            <label for="contactExecuteur" data-i18n="executorContactLabel">Contact de l'ex√©cuteur</label>
                            <input
                                type="text"
                                id="contactExecuteur"
                                name="contactExecuteur"
                                data-i18n-placeholder="executorContactPlaceholder"
                                placeholder="T√©l√©phone ou email"
                            />
                        </div>

                        <div class="form-group">
                            <label for="autresVolontes" data-i18n="otherWishesLabel">Autres volont√©s ou instructions</label>
                            <textarea
                                id="autresVolontes"
                                name="autresVolontes"
                                data-i18n-placeholder="otherWishesPlaceholder"
                                placeholder="Toute autre instruction importante"
                            ></textarea>
                        </div>
                    </div>
                </div>

                <!-- Share buttons on step1 -->
                <div class="share-section">
                    <div class="share-title">Partager ce testament</div>
                    <div class="share-buttons">
                        <button class="share-btn whatsapp" title="Partager via WhatsApp" onclick="sharePDF('whatsapp')">
                            <i class="fab fa-whatsapp"></i>
                        </button>
                        <button class="share-btn facebook" title="Partager via Facebook" onclick="sharePDF('facebook')">
                            <i class="fab fa-facebook-f"></i>
                        </button>
                        <button class="share-btn twitter" title="Partager via Twitter" onclick="sharePDF('twitter')">
                            <i class="fab fa-twitter"></i>
                        </button>
                        <button class="share-btn email" title="Partager par Email" onclick="sharePDF('email')">
                            <i class="fas fa-envelope"></i>
                        </button>
                    </div>
                </div>

                <div class="actions">
                    <button type="button" class="btn btn-primary" onclick="nextStep(2)">√âtape suivante</button>
                    <button
                        type="button"
                        class="btn btn-secondary"
                        onclick="generateAndPreviewPDF()"
                        title="G√©n√©rer le PDF du testament"
                    >
                        <i class="fas fa-file-pdf"></i> G√©n√©rer PDF
                    </button>
                </div>
            </div>

            <!-- √âtape 2: Famille et proches -->
            <div id="step2" class="form-step" style="display: none;">
                <div class="form-container">
                    <div class="form-section">
                        <h2 class="section-title">
                            <i class="fas fa-users"></i> <span data-i18n="familyTitle">Famille et proches</span>
                        </h2>

                        <div class="family-category">
                            <div class="category-header" onclick="toggleCategory('parents')">
                                <div class="category-title">
                                    <i class="fas fa-user-friends"></i> <span data-i18n="parentsCategory">Parents</span>
                                </div>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div id="parents" class="category-content">
                                <div id="parents-container"></div>
                                <button type="button" class="add-person-btn" onclick="addPerson('parents')">
                                    <i class="fas fa-plus"></i> <span data-i18n="addParent">Ajouter un parent</span>
                                </button>
                            </div>
                        </div>

                        <div class="family-category">
                            <div class="category-header" onclick="toggleCategory('conjoints')">
                                <div class="category-title">
                                    <i class="fas fa-ring"></i> <span data-i18n="spousesCategory">√âpoux/√âpouse</span>
                                </div>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div id="conjoints" class="category-content">
                                <div id="conjoints-container"></div>
                                <button type="button" class="add-person-btn" onclick="addPerson('conjoints')">
                                    <i class="fas fa-plus"></i> <span data-i18n="addSpouse">Ajouter un conjoint</span>
                                </button>
                            </div>
                        </div>

                        <div class="family-category">
                            <div class="category-header" onclick="toggleCategory('freres-soeurs')">
                                <div class="category-title">
                                    <i class="fas fa-users"></i> <span data-i18n="siblingsCategory">Fr√®res et Soeurs</span>
                                </div>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div id="freres-soeurs" class="category-content">
                                <div id="freres-soeurs-container"></div>
                                <button type="button" class="add-person-btn" onclick="addPerson('freres-soeurs')">
                                    <i class="fas fa-plus"></i> <span data-i18n="addSibling">Ajouter un fr√®re/une soeur</span>
                                </button>
                            </div>
                        </div>

                        <div class="family-category">
                            <div class="category-header" onclick="toggleCategory('enfants')">
                                <div class="category-title">
                                    <i class="fas fa-baby"></i> <span data-i18n="childrenCategory">Enfants</span>
                                </div>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div id="enfants" class="category-content">
                                <div id="enfants-container"></div>
                                <button type="button" class="add-person-btn" onclick="addPerson('enfants')">
                                    <i class="fas fa-plus"></i> <span data-i18n="addChild">Ajouter un enfant</span>
                                </button>
                            </div>
                        </div>

                        <div class="family-category">
                            <div class="category-header" onclick="toggleCategory('amis')">
                                <div class="category-title">
                                    <i class="fas fa-heart"></i> <span data-i18n="friendsCategory">Amis proches</span>
                                </div>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div id="amis" class="category-content">
                                <div id="amis-container"></div>
                                <button type="button" class="add-person-btn" onclick="addPerson('amis')">
                                    <i class="fas fa-plus"></i> <span data-i18n="addFriend">Ajouter un ami</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h2 class="section-title">
                            <i class="fas fa-info-circle"></i> <span data-i18n="additionalInfoTitle">Informations compl√©mentaires</span>
                        </h2>

                        <div class="form-group">
                            <label for="autresProches" data-i18n="otherPeopleLabel">Autres personnes √† mentionner</label>
                            <textarea
                                id="autresProches"
                                name="autresProches"
                                data-i18n-placeholder="otherPeoplePlaceholder"
                                placeholder="Toute autre personne que vous souhaitez mentionner dans votre testament"
                            ></textarea>
                        </div>

                        <div class="form-group">
                            <label for="relationsParticulieres" data-i18n="specialRelationsLabel">Relations particuli√®res</label>
                            <textarea
                                id="relationsParticulieres"
                                name="relationsParticulieres"
                                data-i18n-placeholder="specialRelationsPlaceholder"
                                placeholder="D√©crivez toute relation particuli√®re ou situation familiale importante"
                            ></textarea>
                        </div>

                        <div class="form-group">
                            <label for="personnesPrevenir" data-i18n="peopleToNotifyLabel">Personnes √† pr√©venir en priorit√©</label>
                            <textarea
                                id="personnesPrevenir"
                                name="personnesPrevenir"
                                data-i18n-placeholder="peopleToNotifyPlaceholder"
                                placeholder="Liste des personnes √† contacter en priorit√© en cas de d√©c√®s"
                            ></textarea>
                        </div>
                    </div>
                </div>

                <!-- Share buttons on step2 -->
                <div class="share-section">
                    <div class="share-title">Partager ce testament</div>
                    <div class="share-buttons">
                        <button class="share-btn whatsapp" title="Partager via WhatsApp" onclick="sharePDF('whatsapp')">
                            <i class="fab fa-whatsapp"></i>
                        </button>
                        <button class="share-btn facebook" title="Partager via Facebook" onclick="sharePDF('facebook')">
                            <i class="fab fa-facebook-f"></i>
                        </button>
                        <button class="share-btn twitter" title="Partager via Twitter" onclick="sharePDF('twitter')">
                            <i class="fab fa-twitter"></i>
                        </button>
                        <button class="share-btn email" title="Partager par Email" onclick="sharePDF('email')">
                            <i class="fas fa-envelope"></i>
                        </button>
                    </div>
                </div>

                <div class="actions">
                    <button type="button" class="btn btn-secondary" onclick="prevStep(1)">√âtape pr√©c√©dente</button>
                    <button type="button" class="btn btn-primary" onclick="nextStep(3)">√âtape suivante</button>
                    <button
                        type="button"
                        class="btn btn-secondary"
                        onclick="generateAndPreviewPDF()"
                        title="G√©n√©rer le PDF du testament"
                    >
                        <i class="fas fa-file-pdf"></i> G√©n√©rer PDF
                    </button>
                </div>
            </div>

            <!-- √âtape 3: Biens mat√©riels et financiers -->
            <div id="step3" class="form-step" style="display: none;">
                <div class="form-container">
                    <div class="form-section">
                        <h2 class="section-title">
                            <i class="fas fa-home"></i> <span data-i18n="realEstateTitle">Biens immobiliers</span>
                        </h2>

                        <div class="asset-category">
                            <div class="category-header" onclick="toggleCategory('immobilier')">
                                <div class="category-title">
                                    <i class="fas fa-building"></i> <span data-i18n="propertiesCategory">Propri√©t√©s immobili√®res</span>
                                </div>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div id="immobilier" class="category-content">
                                <div id="immobilier-container"></div>
                                <button type="button" class="add-person-btn" onclick="addAsset('immobilier')">
                                    <i class="fas fa-plus"></i> <span data-i18n="addProperty">Ajouter un bien immobilier</span>
                                </button>
                            </div>
                        </div>

                        <div class="privacy-notice">
                            <i class="fas fa-shield-alt"></i>
                            <span data-i18n="privacyNotice1"
                                >Les informations personnelles que vous saisissez sont sous votre responsabilit√©. Nous recommandons de ne pas inclure de donn√©es trop sensibles.</span
                            >
                        </div>
                    </div>

                    <div class="form-section">
                        <h2 class="section-title">
                            <i class="fas fa-car"></i> <span data-i18n="materialGoodsTitle">Biens mat√©riels</span>
                        </h2>

                        <div class="asset-category">
                            <div class="category-header" onclick="toggleCategory('materiel')">
                                <div class="category-title">
                                    <i class="fas fa-tshirt"></i> <span data-i18n="valuableGoodsCategory">Biens de valeur</span>
                                </div>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div id="materiel" class="category-content">
                                <div id="materiel-container"></div>
                                <button type="button" class="add-person-btn" onclick="addAsset('materiel')">
                                    <i class="fas fa-plus"></i> <span data-i18n="addMaterialGood">Ajouter un bien mat√©riel</span>
                                </button>
                            </div>
                        </div>

                        <div class="asset-category">
                            <div class="category-header" onclick="toggleCategory('personnels')">
                                <div class="category-title">
                                    <i class="fas fa-book"></i> <span data-i18n="personalGoodsCategory">Biens personnels</span>
                                </div>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div id="personnels" class="category-content">
                                <div id="personnels-container"></div>
                                <button type="button" class="add-person-btn" onclick="addAsset('personnels')">
                                    <i class="fas fa-plus"></i> <span data-i18n="addPersonalGood">Ajouter un bien personnel</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h2 class="section-title">
                            <i class="fas fa-university"></i> <span data-i18n="bankAccountsTitle">Comptes bancaires</span>
                        </h2>

                        <div class="asset-category">
                            <div class="category-header" onclick="toggleCategory('comptes')">
                                <div class="category-title">
                                    <i class="fas fa-piggy-bank"></i> <span data-i18n="accountsCategory">Comptes et √©pargnes</span>
                                </div>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div id="comptes" class="category-content">
                                <div id="comptes-container"></div>
                                <button type="button" class="add-person-btn" onclick="addAsset('comptes')">
                                    <i class="fas fa-plus"></i> <span data-i18n="addAccount">Ajouter un compte</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h2 class="section-title">
                            <i class="fas fa-credit-card"></i> <span data-i18n="bankCardsTitle">Cartes et acc√®s bancaires</span>
                        </h2>

                        <div class="asset-category">
                            <div class="category-header" onclick="toggleCategory('cartes')">
                                <div class="category-title">
                                    <i class="fas fa-credit-card"></i> <span data-i18n="cardsCategory">Cartes bancaires</span>
                                </div>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div id="cartes" class="category-content">
                                <div id="cartes-container"></div>
                                <button type="button" class="add-person-btn" onclick="addAsset('cartes')">
                                    <i class="fas fa-plus"></i> <span data-i18n="addCard">Ajouter une carte</span>
                                </button>
                            </div>
                        </div>

                        <div class="asset-category">
                            <div class="category-header" onclick="toggleCategory('applications')">
                                <div class="category-title">
                                    <i class="fas fa-mobile-alt"></i> <span data-i18n="bankAppsCategory">Applications bancaires</span>
                                </div>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div id="applications" class="category-content">
                                <div id="applications-container"></div>
                                <button type="button" class="add-person-btn" onclick="addAsset('applications')">
                                    <i class="fas fa-plus"></i> <span data-i18n="addAccess">Ajouter un acc√®s</span>
                                </button>
                            </div>
                        </div>

                        <div class="privacy-notice">
                            <i class="fas fa-exclamation-triangle"></i>
                            <span data-i18n="privacyNotice2">
                                Pour des raisons de s√©curit√©, il est recommand√© de ne pas enregistrer les mots de
                                passe complets ou les codes confidentiels. Indiquez plut√¥t o√π ces informations
                                peuvent √™tre retrouv√©es.
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Share buttons on step3 -->
                <div class="share-section">
                    <div class="share-title">Partager ce testament</div>
                    <div class="share-buttons">
                        <button class="share-btn whatsapp" title="Partager via WhatsApp" onclick="sharePDF('whatsapp')">
                            <i class="fab fa-whatsapp"></i>
                        </button>
                        <button class="share-btn facebook" title="Partager via Facebook" onclick="sharePDF('facebook')">
                            <i class="fab fa-facebook-f"></i>
                        </button>
                        <button class="share-btn twitter" title="Partager via Twitter" onclick="sharePDF('twitter')">
                            <i class="fab fa-twitter"></i>
                        </button>
                        <button class="share-btn email" title="Partager par Email" onclick="sharePDF('email')">
                            <i class="fas fa-envelope"></i>
                        </button>
                    </div>
                </div>

                <div class="actions">
                    <button type="button" class="btn btn-secondary" onclick="prevStep(2)">√âtape pr√©c√©dente</button>
                    <button type="button" class="btn btn-primary" onclick="nextStep(4)">√âtape suivante</button>
                    <button
                        type="button"
                        class="btn btn-secondary"
                        onclick="generateAndPreviewPDF()"
                        title="G√©n√©rer le PDF du testament"
                    >
                        <i class="fas fa-file-pdf"></i> G√©n√©rer PDF
                    </button>
                </div>
            </div>

            <!-- √âtape 4: Dettes et devoirs religieux -->
            <div id="step4" class="form-step" style="display: none;">
                <div class="form-container">
                    <div class="form-section">
                        <h2 class="section-title">
                            <i class="fas fa-hand-holding-usd"></i> <span data-i18n="receivablesTitle">Cr√©ances √† percevoir</span>
                        </h2>

                        <div class="asset-category">
                            <div class="category-header" onclick="toggleCategory('creances')">
                                <div class="category-title">
                                    <i class="fas fa-coins"></i> <span data-i18n="receivablesCategory">Cr√©ances</span>
                                </div>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div id="creances" class="category-content">
                                <div id="creances-container"></div>
                                <button type="button" class="add-person-btn" onclick="addAsset('creances')">
                                    <i class="fas fa-plus"></i> <span data-i18n="addReceivable">Ajouter une cr√©ance</span>
                                </button>
                            </div>
                        </div>

                        <div class="privacy-notice">
                            <i class="fas fa-shield-alt"></i>
                            <span data-i18n="privacyNotice3">
                                Les informations financi√®res restent confidentielles. Ne partagez pas avec des tiers.
                            </span>
                        </div>
                    </div>

                    <div class="form-section">
                        <h2 class="section-title">
                            <i class="fas fa-praying-hands"></i> <span data-i18n="religiousDutiesTitle">Dettes et devoirs religieux</span>
                        </h2>

                        <div class="form-group">
                            <label for="dettes" data-i18n="debtsLabel">Dettes √† rembourser</label>
                            <textarea
                                id="dettes"
                                name="dettes"
                                data-i18n-placeholder="debtsPlaceholder"
                                placeholder="D√©crivez les dettes √† rembourser"
                            ></textarea>
                        </div>

                        <div class="form-group">
                            <label for="zakat" data-i18n="zakatLabel">Calcul de la Zakat</label>
                            <input
                                type="number"
                                id="zakat"
                                name="zakat"
                                min="0"
                                step="0.01"
                                placeholder="Montant de la Zakat due"
                            />
                        </div>

                        <div class="zakat-calculator">
                            <button type="button" class="btn btn-primary" onclick="calculateZakat()">
                                Calculer la Zakat
                            </button>
                            <div id="zakatResult" class="calculator-result"></div>
                        </div>
                    </div>
                </div>

                <!-- Share buttons on step4 -->
                <div class="share-section">
                    <div class="share-title">Partager ce testament</div>
                    <div class="share-buttons">
                        <button class="share-btn whatsapp" title="Partager via WhatsApp" onclick="sharePDF('whatsapp')">
                            <i class="fab fa-whatsapp"></i>
                        </button>
                        <button class="share-btn facebook" title="Partager via Facebook" onclick="sharePDF('facebook')">
                            <i class="fab fa-facebook-f"></i>
                        </button>
                        <button class="share-btn twitter" title="Partager via Twitter" onclick="sharePDF('twitter')">
                            <i class="fab fa-twitter"></i>
                        </button>
                        <button class="share-btn email" title="Partager par Email" onclick="sharePDF('email')">
                            <i class="fas fa-envelope"></i>
                        </button>
                    </div>
                </div>

                <div class="actions">
                    <button type="button" class="btn btn-secondary" onclick="prevStep(3)">√âtape pr√©c√©dente</button>
                    <button type="button" class="btn btn-primary" onclick="nextStep(5)">√âtape suivante</button>
                    <button
                        type="button"
                        class="btn btn-secondary"
                        onclick="generateAndPreviewPDF()"
                        title="G√©n√©rer le PDF du testament"
                    >
                        <i class="fas fa-file-pdf"></i> G√©n√©rer PDF
                    </button>
                </div>
            </div>

            <!-- √âtape 5: Confirmation r√©sum√© -->
            <div id="step5" class="form-step" style="display: none;">
                <div class="form-section">
                    <h2 class="section-title">
                        <i class="fas fa-check-circle"></i> <span data-i18n="confirmationTitle">Confirmation et r√©sum√©</span>
                    </h2>
                    <div id="summaryContent" style="white-space: pre-wrap; color: var(--secondary);"></div>
                </div>

                <!-- Share buttons on step5 -->
                <div class="share-section">
                    <div class="share-title">Partager ce testament</div>
                    <div class="share-buttons">
                        <button class="share-btn whatsapp" title="Partager via WhatsApp" onclick="sharePDF('whatsapp')">
                            <i class="fab fa-whatsapp"></i>
                        </button>
                        <button class="share-btn facebook" title="Partager via Facebook" onclick="sharePDF('facebook')">
                            <i class="fab fa-facebook-f"></i>
                        </button>
                        <button class="share-btn twitter" title="Partager via Twitter" onclick="sharePDF('twitter')">
                            <i class="fab fa-twitter"></i>
                        </button>
                        <button class="share-btn email" title="Partager par Email" onclick="sharePDF('email')">
                            <i class="fas fa-envelope"></i>
                        </button>
                    </div>
                </div>

                <div class="actions">
                    <button type="button" class="btn btn-secondary" onclick="prevStep(4)">√âtape pr√©c√©dente</button>
                    <button
                        type="button"
                        class="btn btn-primary"
                        onclick="generateAndPreviewPDF()"
                        title="G√©n√©rer le PDF du testament"
                    >
                        <i class="fas fa-file-pdf"></i> G√©n√©rer PDF
                    </button>
                </div>
            </div>
        </form>
    </div>

    <!-- JS Libraries for pdf generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script>
        // Navigation between steps handling and progress bar
        const totalSteps = 5;
        function nextStep(step) {
            if (step > totalSteps) return;
            for (let i = 1; i <= totalSteps; i++) {
                document.getElementById("step" + i).style.display = "none";
            }
            document.getElementById("step" + step).style.display = "block";

            const progressFill = document.getElementById("progressFill");
            progressFill.style.width = (step / totalSteps) * 100 + "%";

            const stepIndicator = document.getElementById("stepIndicator");
            stepIndicator.textContent = `√âtape ${step} sur ${totalSteps} : ${getStepDescription(step)}`;

            if (step === totalSteps) {
                // Update summary on step 5
                updateSummary();
            }
        }

        function prevStep(step) {
            if (step < 1) return;
            nextStep(step);
        }

        // Descriptions for progress indicator - keep original texts or update accordingly
        function getStepDescription(step) {
            const descriptions = {
                1: "Informations personnelles et volont√©s g√©n√©rales",
                2: "Famille et proches",
                3: "Biens mat√©riels et financiers",
                4: "Dettes et devoirs religieux",
                5: "Confirmation et r√©sum√©",
            };
            return descriptions[step] || "";
        }

        // Toggle conjoint field visibility on step 1
        function toggleConjointField() {
            const sexe = document.getElementById("sexe").value;
            const situation = document.getElementById("situationFamiliale").value;
            const conjointGroup = document.getElementById("conjointGroup");
            if (situation === "marie" || situation === "marie(e)") {
                conjointGroup.style.display = "block";
            } else {
                conjointGroup.style.display = "none";
                document.getElementById("conjoint").value = "";
            }
        }

        // Toggle category collapse (for family and assets categories)
        function toggleCategory(catId) {
            const el = document.getElementById(catId);
            if (!el) return;
            el.classList.toggle("active");
        }

        // Dummy functions for addPerson and addAsset to preserve original behavior as placeholder
        function addPerson(category) {
            alert(`Ajout d'une personne dans la cat√©gorie: ${category} (fonction √† impl√©menter)`);
        }
        function addAsset(category) {
            alert(`Ajout d'un bien dans la cat√©gorie: ${category} (fonction √† impl√©menter)`);
        }

        // Update summary content on step 5 from form values (simple textual extraction)
        function updateSummary() {
            const formData = new FormData(document.getElementById("testamentForm"));
            let summaryText = "";

            // Listing fields from step1
            summaryText += "----- Informations personnelles -----\n";
            summaryText += `Sexe : ${formData.get("sexe") || ""}\n`;
            summaryText += `Pr√©nom : ${formData.get("prenom") || ""}\n`;
            summaryText += `Nom : ${formData.get("nom") || ""}\n`;
            summaryText += `Date de naissance : ${formData.get("dateNaissance") || ""}\n`;
            summaryText += `Lieu de naissance : ${formData.get("lieuNaissance") || ""}\n`;
            summaryText += `Adresse : ${formData.get("adresse") || ""}\n`;
            summaryText += `Nationalit√© : ${formData.get("nationalite") || ""}\n`;
            summaryText += `Situation familiale : ${formData.get("situationFamiliale") || ""}\n`;
            summaryText += `Conjoint : ${formData.get("conjoint") || ""}\n\n`;

            // Volont√©s g√©n√©rales
            summaryText += "----- Volont√©s g√©n√©rales -----\n";
            summaryText += `Obs√®ques : ${formData.get("volontesObseques") || ""}\n`;
            summaryText += `Recommandations : ${formData.get("recommandationsFamille") || ""}\n`;
            summaryText += `Ex√©cuteur testamentaire : ${formData.get("executeurTestament") || ""}\n`;
            summaryText += `Contact ex√©cuteur : ${formData.get("contactExecuteur") || ""}\n`;
            summaryText += `Autres volont√©s : ${formData.get("autresVolontes") || ""}\n\n`;

            // Step 2 and onwards could be summarized similarly but for this example keeping simple
            summaryText += "----- √âtapes 2 √† 4 -----\n";
            summaryText += "Veuillez consulter le formulaire pour d√©tails complets.\n";

            document.getElementById("summaryContent").textContent = summaryText;
        }

        // PDF generation using jsPDF
        const { jsPDF } = window.jspdf;

        async function generateAndPreviewPDF() {
            try {
                const doc = new jsPDF();

                // Title
                doc.setFontSize(20);
                doc.setTextColor("#a89262");
                doc.text("Al Wassiya - Testament Islamique Simplifi√©", 15, 20);

                // Get form data
                const formData = new FormData(document.getElementById("testamentForm"));

                let yPosition = 30;
                doc.setFontSize(14);
                doc.setTextColor("#2d4c68");
                // Step 1 details
                doc.text("Informations personnelles:", 15, yPosition);
                yPosition += 8;

                const fieldsStep1 = [
                    ["Sexe", formData.get("sexe") || ""],
                    ["Pr√©nom", formData.get("prenom") || ""],
                    ["Nom", formData.get("nom") || ""],
                    ["Date de naissance", formData.get("dateNaissance") || ""],
                    ["Lieu de naissance", formData.get("lieuNaissance") || ""],
                    ["Adresse", formData.get("adresse") || ""],
                    ["Nationalit√©", formData.get("nationalite") || ""],
                    ["Situation familiale", formData.get("situationFamiliale") || ""],
                    ["Conjoint", formData.get("conjoint") || ""],
                ];

                doc.setFontSize(12);
                doc.setTextColor("#1e1e24");
                fieldsStep1.forEach(([label, value]) => {
                    if (value && value.trim() !== "") {
                        const lines = doc.splitTextToSize(`${label} : ${value}`, 180);
                        doc.text(lines, 15, yPosition);
                        yPosition += lines.length * 7;
                        if (yPosition > 270) {
                            doc.addPage();
                            yPosition = 20;
                        }
                    }
                });

                yPosition += 5;
                doc.setFontSize(14);
                doc.setTextColor("#2d4c68");
                doc.text("Volont√©s g√©n√©rales:", 15, yPosition);
                yPosition += 8;

                const fieldsStep1Volontes = [
                    ["Obs√®ques", formData.get("volontesObseques") || ""],
                    ["Recommandations", formData.get("recommandationsFamille") || ""],
                    ["Ex√©cuteur testamentaire", formData.get("executeurTestament") || ""],
                    ["Contact ex√©cuteur", formData.get("contactExecuteur") || ""],
                    ["Autres volont√©s", formData.get("autresVolontes") || ""],
                ];

                doc.setFontSize(12);
                doc.setTextColor("#1e1e24");
                fieldsStep1Volontes.forEach(([label, value]) => {
                    if (value && value.trim() !== "") {
                        const lines = doc.splitTextToSize(`${label} : ${value}`, 180);
                        doc.text(lines, 15, yPosition);
                        yPosition += lines.length * 7;
                        if (yPosition > 270) {
                            doc.addPage();
                            yPosition = 20;
                        }
                    }
                });

                yPosition += 10;
                doc.setFontSize(14);
                doc.setTextColor("#2d4c68");
                doc.text("(R√©sum√© des autres √©tapes dans le formulaire web)", 15, yPosition);

                // Save the PDF in a Blob to enable sharing
                const pdfBlob = doc.output("blob");
                window.generatedPdfBlob = pdfBlob; // Store globally for sharing

                // Preview by opening PDF in new tab
                const pdfUrl = URL.createObjectURL(pdfBlob);
                window.open(pdfUrl, "_blank");
            } catch (err) {
                alert("Erreur lors de la g√©n√©ration du PDF : " + err.message);
            }
        }

        // Share PDF function for email and social media
        function sharePDF(platform) {
            if (!window.generatedPdfBlob) {
                alert("Veuillez g√©n√©rer le PDF avant de le partager.");
                return;
            }

            // Create a temporary URL for the PDF
            const pdfUrl = URL.createObjectURL(window.generatedPdfBlob);

            // Encode URL for usage in links
            const encodedUrl = encodeURIComponent(pdfUrl);
            const pageUrl = encodeURIComponent(window.location.href);

            let shareUrl = "";

            switch (platform) {
                case "whatsapp":
                    shareUrl = `https://api.whatsapp.com/send?text=${encodeURIComponent(
                        "Voici mon testament islamique : "
                    )}${pdfUrl}`;
                    break;
                case "facebook":
                    // Facebook does not support direct file uploads via URL; sharing page URL instead
                    shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${pageUrl}`;
                    break;
                case "twitter":
                    shareUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(
                        "Voici mon testament islamique : "
                    )}&url=${pageUrl}`;
                    break;
                case "email":
                    shareUrl = `mailto:?subject=${encodeURIComponent(
                        "Mon testament islamique - Al Wassiya"
                    )}&body=${encodeURIComponent(
                        "Veuillez trouver mon testament islamique ci-joint: " + pdfUrl
                    )}`;
                    break;
                default:
                    alert("Plateforme de partage non prise en charge.");
                    return;
            }

            window.open(shareUrl, "_blank");
        }

        // Zakat calculator (simple example)
        function calculateZakat() {
            const zakatInput = document.getElementById("zakat").value;
            const resultDiv = document.getElementById("zakatResult");
            if (!zakatInput || isNaN(zakatInput) || parseFloat(zakatInput) < 0) {
                resultDiv.style.display = "block";
                resultDiv.textContent = "Veuillez saisir un montant valide pour la Zakat.";
                return;
            }
            const zakat = parseFloat(zakatInput);
            const zakatDue = zakat * 0.025; // 2.5%
            resultDiv.style.display = "block";
            resultDiv.textContent = `La Zakat due est : ${zakatDue.toFixed(2)} unit√©s mon√©taires.`;
        }

        // Initialization
        document.addEventListener("DOMContentLoaded", () => {
            nextStep(1);
        });
    </script>
</body>
</html>
